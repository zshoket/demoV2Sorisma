!(function() {
    angular
        .module("riskMatrix", [])
        .directive("riskMatrix", [
            "$compile",
            function(i) {
                return {
                    restrict: "E",
                    scope: {
                        items: "=data",
                        likelihood: "=likelihood",
                        impact: "=impact",
                        template: "=?template",
                    },
                    link: function(t, e, a) {
                        var s = function(a) {
                            var s = i(a)(t);
                            e.empty(), e.append(s), s.css("height", s[0].clientWidth + "px");
                            for (var o = 0, d = 0; 16 > d; d++)
                                !(function(i) {
                                    var t = i % 4,
                                        e = "low";
                                    ((1 == o && 2 > t) ||
                                        (1 == o && 3 > t) ||
                                        17 == i ||
                                        23 == i) &&
                                    (e = "medium"),
                                    ((2 == o && 2 > t) || (3 == o && 3 > t) || 9 == i) &&
                                    (e = "high"),
                                    s.append(
                                            '<div class="risk-box col-' +
                                            o +
                                            " row-" +
                                            t +
                                            " " +
                                            e +
                                            '-risk"></div>'
                                        ),
                                        3 == t && o++;
                                })(d);
                        };
                        a.template ?
                            t.$watch("template", function() {
                                t.template &&
                                    s(
                                        '<div class="risk-matrix"><div class="left-label">Eintrittswahrscheinlichkeit</div><div class="bottom-label">Schadenshoehe</div><div style="position:absolute;width:100%;height:100%;"><div risk-matrix-item ng-repeat="item in items" class="risk-matrix-item" style="position:absolute;">' +
                                        t.template +
                                        "</div></div></div>"
                                    );
                            }) :
                            s(
                                '<div class="risk-matrix"><div class="left-label">Eintrittswahrscheinlichkeit</div><div class="bottom-label">Schadenshoehe</div><div style="position:absolute;width:100%;height:100%;"><div risk-matrix-item ng-repeat="item in items" class="risk-matrix-item" style="position:absolute;"><div class="closed"><span ng-bind="item.Id"></span></div><div class="open"><div ng-bind="\'Likelihood: \'+item.RiskLikelihood"></div><div ng-bind="\'Impact: \'+item.RiskImpact"></div></div></div></div></div>'
                            );
                    },
                };
            },
        ])
        .directive("riskMatrixItem", [
            "$timeout",
            function(i) {
                return {
                    restrict: "A",
                    link: function(t, e) {
                        e.css({
                                left: 50 * Math.random() + 4 + "%",
                                bottom: 50 * Math.random() + 4 + "%",
                            }),
                            t.$watch(
                                "item",
                                function() {
                                    i(function() {
                                        e.css({
                                            left: 20 * t.impact.indexOf(t.item.RiskImpact) +
                                                10 * Math.random() +
                                                5 +
                                                "%",
                                            bottom: 20 * t.likelihood.indexOf(t.item.RiskLikelihood) +
                                                10 * Math.random() +
                                                5 +
                                                "%",
                                        });
                                    }, 500);
                                }, !0
                            );
                    },
                };
            },
        ]);
})();